---
interface Props {
  title: string;
  items: Array<{
    title: string;
    href: string;
    image: string;
  }>;
  defaultOpen?: boolean;
}

const { title, items, defaultOpen = false } = Astro.props;
const accordionId = `accordion-${title.toLowerCase().replace(/\s+/g, '-')}`;
---

<div class="accordion-container mb-4">
  <button
    class="accordion-header w-full flex items-center justify-center p-4 bg-gray-800 bg-opacity-70 rounded-xl hover:bg-opacity-90 transition-all relative"
    aria-expanded={defaultOpen ? "true" : "false"}
    aria-controls={accordionId}
    data-accordion-toggle={accordionId}
  >
    <h2 class="text-xl font-bold text-white">{title}</h2>
    <svg
      class="accordion-icon w-6 h-6 text-white transition-transform duration-300 absolute right-4"
      class:list={{ 'rotate-180': defaultOpen }}
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id={accordionId}
    class="accordion-content overflow-hidden transition-all duration-300"
    class:list={{ 'max-h-0': !defaultOpen, 'max-h-[5000px]': defaultOpen }}
  >
    <div class="pt-4 space-y-3">
      {items.map((item) => (
        <a
          href={item.href}
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-4 p-3 bg-gray-800 bg-opacity-50 rounded-lg hover:bg-opacity-80 transition-all group"
        >
          <img
            src={item.image}
            alt={item.title}
            class="w-16 h-16 object-cover rounded-md flex-shrink-0"
          />
          <span class="text-white font-medium group-hover:text-blue-400 transition-colors">
            {item.title}
          </span>
        </a>
      ))}
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('[data-accordion-toggle]').forEach((button) => {
    button.addEventListener('click', () => {
      const targetId = button.getAttribute('data-accordion-toggle');
      const content = document.getElementById(targetId!);
      const icon = button.querySelector('.accordion-icon');
      const isExpanded = button.getAttribute('aria-expanded') === 'true';

      // Toggle aria-expanded
      button.setAttribute('aria-expanded', (!isExpanded).toString());

      // Toggle content
      if (isExpanded) {
        content?.classList.remove('max-h-[5000px]');
        content?.classList.add('max-h-0');
        icon?.classList.remove('rotate-180');
      } else {
        content?.classList.remove('max-h-0');
        content?.classList.add('max-h-[5000px]');
        icon?.classList.add('rotate-180');
      }
    });
  });
</script>
